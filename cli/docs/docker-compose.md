# Managing Docker Resources with syntho-cli

In this guide, we will walk through how to use `syntho-cli` to effectively manage your resources in a 
Docker host environment.

## Prerequisites

* `syntho-cli` installed ([See Getting Started guide](./getting-started.md))
* A running Docker server
* `docker` cli installed and properly configured
* An active internet connection on the host where the CLI is going to run
* Other command line utilities: `tar`, `awk`, `curl or wget`,`jq` and `grep`
* The docker node must be of the `amd64` architecture
* For remote docker deployment
    * ssh-agent
    * scp
    * an ssh private key to connect to a remote host where the docker server is running on


## Overview

`syntho-cli` interacts with docker server to automate the deployment and management of Syntho applications.

## Running `syntho-cli` for Docker

Below are examples of common tasks you might want to perform with `syntho-cli` in Docker server:

> TL;DR: `syntho-cli dc --help`

### Deploy a Resource

To deploy a new resource:


Option 1;
```
syntho-cli dc deployment \
    --license-key <license-key> \
    --registry-user <syntho-image-registry-user> \
    --registry-pwd <syntho-image-registry-password> \
    --version <syntho-stack-version> \
    --docker-host ssh://<user>@<ip> \ # optional - default: unix:///var/run/docker.sock
    --docker-ssh-user-private-key <path-to-your-private-key> \ # optional - only for remote docker deployment
    --docker-config <path-to-docker-config-json> # optional - default: ~/.docker/config.json
```

Option 2;
- Pre-requirement: Pre pulling images to a [trusted image registry](./utilities.md#pulling-images-into-a-trusted-image-registry)

syntho-cli dc deployment \
    --license-key <license-key> \
    --version <syntho-stack-version> \
    --docker-host ssh://<user>@<ip> \ # optional - default: unix:///var/run/docker.sock
    --docker-ssh-user-private-key <path-to-your-private-key> \ # optional - only for remote docker deployment
    --docker-config <path-to-docker-config-json> # optional - default: ~/.docker/config.json
    --use-trusted-registry


> Ask Syntho team to fetch your credentials and the version for Syntho resources

> Deployment process takes roughly 10 mins as it is going to be managing various resources.
> When the deployment is finished, a deployment id is generated by the CLI and it is stored under
> the CLI's metadata. Which means, with CLI, this deployment can be managed later on.

#### Configuration

During the deployment, there will be a few questions, regarding how you would like to configure
your Syntho setup.

> You don't need to pay extra attention to here unless you really want to, because CLI will guide you
 to provide these configuration values.

- Ray Head Resources: Ray Head instance will be configured based on the given inputs
- Syntho UI Login Credentials: You are defining your own credentials to login the Syntho UI
- Domain: your.domain.com, or your.ip - This will be necessary to avoid CORS issues when the
  deployment is completed

> Each configuration questions have a default value if they are not provided. And, CLI will
> smoothly guide you till the end.


### Seeing the Existing Deployments and Their Statuses

To see the existing deployments:

```
syntho-cli dc deployments
```

You will see an output similar to below

```
- finished_at: '2024-02-02T23:21:32.718262'
  host_name: unix:///var/run/docker.sock
  id: dc-432061aea0991dccab8a8dabb0862440
  started_at: '2024-02-02T23:10:27.123024'
  status: completed
  version: 0.1.0-alpha.10

```

### Seeing an Existing Deployment and Its Status

To see an existing deployment:

```
syntho-cli dc status --deployment-id dc-432061aea0991dccab8a8dabb0862440
```

You will see an output similar to below

```
finished_at: '2024-02-02T23:21:32.718262'
host_name: unix:///var/run/docker.sock
id: dc-432061aea0991dccab8a8dabb0862440
started_at: '2024-02-02T23:10:27.123024'
status: completed
version: 0.1.0-alpha.10

```

### Destroying an Existing Deployment

To destroy an existing deployment:

```
syntho-cli dc destroy --deployment-id dc-432061aea0991dccab8a8dabb0862440
```

> Deployment metadata alongside existing Syntho Docker resources will be deleted
